var Revise=(()=>{var se=Object.defineProperty;var Ve=t=>se(t,"__esModule",{value:!0});var _e=(t,e)=>{Ve(t);for(var n in e)se(t,n,{get:e[n],enumerable:!0})};var Be={};_e(Be,{Fragment:()=>Pe,InvariantError:()=>M,OnCollectionRelease:()=>le,VERSION:()=>$e,calc:()=>Le,collection:()=>Se,debug:()=>ze,default:()=>Ue,effect:()=>I,flush:()=>Ge,model:()=>De,mount:()=>we,name:()=>G,ref:()=>de,release:()=>y,reset:()=>Ie,retain:()=>_,setLogLevel:()=>pe,subscribe:()=>He});var M=class extends Error{},v=Symbol("reviseType"),k=Symbol("calculationType");function ce(t){return t&&t[v]==="ref"}function de(t){return{[v]:"ref",current:t}}var le=Symbol("OnCollectionRelease");function ae(t){return Object.assign(t,{[v]:"calculation",[k]:"calculation"})}function ue(t){return Object.assign(t,{[v]:"calculation",[k]:"effect"})}function j(t){return!!(t&&t[v]==="collection")}function w(t){return!!(t&&t[v]==="calculation")}function fe(t){return t[k]==="effect"}var U={error:0,warn:1,info:2,debug:3},K=U.warn;function pe(t){x(()=>t in U,t),K=U[t]}function E(...t){K>=U.debug&&console.log(...t)}function he(...t){K>=U.warn&&console.warn(...t)}function m(...t){K>=U.error&&console.error(...t)}function X(t,...e){t instanceof Error?(m(t),m(...e)):m(t,...e)}function x(t,...e){t()||m("Invariant error",t.toString(),"is not truthy",...e)}function $(t,...e){if(!t)throw m("Assertion failure",t.toString(),"is not truthy",...e),new Error("Assertion failure")}function ge(t,...e){throw m("Assertion failure",t,"is not exhausted",...e),new Error("Assertion failure")}var q={},P=t=>t===q;var V=class{constructor(){this.maxId=0,this.idMap=new WeakMap,this.nodes={},this.edgeMap={},this.reverseEdgeMap={},this.refCount={},this.cullableSet={},this._addNode(q),this.sentinelId=this.getItemId(q)}getItemId(e){let n;return(n=this.idMap.get(e))===void 0&&(n=this.maxId.toString(),this.maxId+=1,this.idMap.set(e,n)),n}addNode(e){return this._addNode(e)}_addNode(e){let n=this.getItemId(e);return this.nodes[n]?!1:(this.refCount[n]=0,P(e)||(this.cullableSet[n]=!0),this.nodes[n]=e,this.edgeMap[n]={},this.reverseEdgeMap[n]={},!0)}hasNode(e){return!!this.nodes[this.getItemId(e)]}addEdge(e,n){let r=this.getItemId(e),o=this.getItemId(n);return this._addEdge(r,o)}_addEdge(e,n){let r=this.nodes[e],o=this.nodes[n];return x(()=>e===this.sentinelId||!!this.nodes[e],"addEdge fromNode does not exist",r),x(()=>!!this.nodes[n],"addEdge toNode does not exist",o),this.edgeMap[e]||(this.edgeMap[e]={}),this.edgeMap[e][n]?!1:(this.edgeMap[e][n]=o,this.reverseEdgeMap[n]||(this.reverseEdgeMap[n]={}),this.reverseEdgeMap[n][e]=r,this.refCount[e]+=1,delete this.cullableSet[e],!0)}removeEdge(e,n){let r=this.getItemId(e),o=this.getItemId(n),i=this._removeEdge(r,o);return x(()=>i===!1,"removeEdge attempted on nonexistent edge",{fromNode:e,toNode:n}),i}removeNode(e){let n=this.getItemId(e);return this._removeNode(n)}_removeNode(e){if(!this.nodes[e])return!0;let n=this.nodes[e];return Object.keys(this.edgeMap[e]).forEach(r=>this._removeEdge(e,r)),Object.keys(this.reverseEdgeMap[e]).forEach(r=>this._removeEdge(r,e)),x(()=>this.refCount[e]===0,"still has refcount after deleting edges",n),x(()=>this.cullableSet[e]===!0,"not cullable after deleting edges",n),delete this.nodes[e],delete this.edgeMap[e],delete this.reverseEdgeMap[e],delete this.refCount[e],delete this.cullableSet[e],!1}_removeEdge(e,n){return $(!!this.edgeMap[e],"_removeEdge fromId not found in edgeMap",e),$(!!this.reverseEdgeMap[n],"_removeEdge toId not found in reverseEdgeMap",n),this.edgeMap[e][n]?(delete this.edgeMap[e][n],this.refCount[e]-=1,this.refCount[e]===0&&(this.cullableSet[e]=!0),delete this.reverseEdgeMap[n][e],!1):(m("_removeEdge edge not found",{fromId:e,toId:n}),!0)}retain(e){let n=this._addEdge(this.getItemId(e),this.sentinelId);x(()=>!!n,"double-retained",e)}release(e){let n=this._removeEdge(this.getItemId(e),this.sentinelId);x(()=>!n,"released a non-retained node",e)}removeEdges(e){e.forEach(([n,r])=>{let o=this.getItemId(n),i=this.getItemId(r);this._removeEdge(o,i)})}getDependencies(e){let n=this.getItemId(e);if(!this.edgeMap[n])return[];let r=[];return Object.values(this.edgeMap[n]).forEach(o=>{P(o)||r.push(o)}),r}getReverseDependencies(e){let n=this.getItemId(e);if(!this.reverseEdgeMap[n])return[];let r=[];return Object.values(this.reverseEdgeMap[n]).forEach(o=>{P(o)||r.push(o)}),r}visitTopological(e){let n={},r=[],o=i=>{if(n[i])return;n[i]=!0,Object.keys(this.edgeMap[i]||{}).forEach(l=>{o(l)});let s=this.nodes[i];P(s)||r.unshift(s)};Object.keys(this.nodes).forEach(i=>{o(i)}),r.forEach(i=>{e(i)})}garbageCollect(){let e=[];for(;Object.keys(this.cullableSet).length>0;)Object.keys(this.cullableSet).forEach(n=>{let r=this.nodes[n];$(!P(r),"tried to garbage collect sentinel"),e.push(r),this._removeNode(n)});return e}graphviz(e){let n=["digraph dag {"];return Object.entries(this.nodes).forEach(([r,o])=>{let i={label:P(o)?"<ROOT>":e(r,o)};P(o)&&(i.shape="circle"),n.push(`  item_${r} [${Object.entries(i).map(([s,l])=>`${s}=${JSON.stringify(l)}`).join(",")}];`)}),Object.entries(this.edgeMap).forEach(([r,o])=>{Object.keys(o).forEach(i=>{n.push(`  item_${r} -> item_${i};`)})}),n.push("}"),n.join(`
`)}};function me(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="element")}function Ee(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="component")}var ee=Symbol("VNode");function be({domNode:t}){let e={domNode:t,children:[],parentNode:null,domParent:null,jsxNode:null,onUnmount:[],[ee]:!0};return e.domParent=e,e}function b({jsxNode:t,domNode:e,domParent:n,onUnmount:r,parentNode:o}){return{domNode:e,children:[],parentNode:o,domParent:n,jsxNode:t,onUnmount:r,[ee]:!0}}function W({parentNode:t,domParent:e}){return{domNode:null,children:[],parentNode:t,domParent:e,jsxNode:null,onUnmount:[],[ee]:!0}}function ye(t){let e=[];function n(r){r.domNode?e.push(r.domNode):r.children.forEach(o=>n(o))}return n(t),e}function Ae(t,e,n){let r=0;function o(s){return s.domNode?(r+=1,!1):i(s)}function i(s){let l=s===e?n:s.children.length;for(let a=0;a<l;++a)if(o(s.children[a]))return!0;return s===e}return i(t),r}function Ne(t){t.children.forEach(e=>Ne(e)),t.onUnmount&&t.onUnmount.forEach(e=>{try{e()}catch(n){X(n,"VNode node raised exception in onUnmount",t)}})}function N(t,e){return te(t.parentNode,t,1,[e])[0]}function te(t,e,n,r){let o,i;e?(i=t.children.indexOf(e),i===-1&&(i=t.children.length),o=e.domParent):(i=t.children.length,o=t.domNode?t:t.domParent),$(o,"tried to replace a root tree slot with missing domParent");let s=t.children.splice(i,n,...r);if(s.forEach(a=>{Ne(a),ye(a).forEach(u=>{u.parentNode&&u.parentNode.removeChild(u)})}),!o.domNode)throw new Error("Invariant: domParent missing domNode");let l=o.domNode;return r.forEach(a=>{if(a.parentNode=t,a.domParent=o,a.domNode){let g=Ae(o,t,i),u=l.childNodes[g];l.insertBefore(a.domNode,u||null)}}),s}function ve(t,e,...n){return typeof t=="string"?{type:"element",element:t,props:e,children:n}:{type:"component",component:t,props:e,children:n}}var xe=new WeakMap;function Ce(t,e,n){t instanceof HTMLInputElement&&(e==="checked"||e==="indeterminate")&&t[e]!==n&&(t[e]=n),t instanceof HTMLOptionElement&&e=="selected"&&t[e]!==n&&(t[e]=n)}function ne(t,e,n){t instanceof HTMLInputElement&&e==="value"&&t[e]!==n&&(t[e]=n),t instanceof HTMLTextAreaElement&&e==="value"&&t[e]!==n&&(t[e]=n),t instanceof HTMLOptionElement&&e==="value"&&t[e]!==n&&(t[e]=n)}function Me(t,e,n){if(n==null||n===!1)t.removeAttribute(e),Ce(t,e,!1),ne(t,e,"");else if(n===!0)t.setAttribute(e,""),Ce(t,e,!0);else if(typeof n=="string")t.setAttribute(e,n),ne(t,e,n);else if(typeof n=="number")t.setAttribute(e,n.toString()),ne(t,e,n.toString());else if(e.startsWith("on:")&&typeof n=="function"){let r=e.slice(3),o=xe.get(t);o||(o={},xe.set(t,o)),o[e]&&t.removeEventListener(r,o[e]),t.addEventListener(r,n),o[e]=n}}function Q({domParent:t,parentNode:e,jsxNode:n}){let r=W({domParent:t,parentNode:e});e.children.push(r),R({nodeToReplace:r,jsxNode:n})}function R({nodeToReplace:t,jsxNode:e}){if(e==null||e===!1||e===!0){let n=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:null,onUnmount:[]});return N(t,n),n}if(typeof e=="string"){let n=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:document.createTextNode(e),onUnmount:[]});return N(t,n),n}if(typeof e=="number"){let n=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:document.createTextNode(e.toString()),onUnmount:[]});return N(t,n),n}if(me(e)){let n=document.createElement(e.element),r=[],o;e.props&&Object.entries(e.props).forEach(([s,l])=>{if(s==="ref"){if(ce(l)){l.current=n;return}if(typeof l=="function"&&!w(l)){o=l;return}}if(w(l)){let a=G(I(()=>{let g=l();Me(n,s,g)}),`view:bindAttribute:${s}:`);_(a),r.push(a),a()}else Me(n,s,l)});let i=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:n,onUnmount:[()=>{r.forEach(s=>y(s)),o&&o(void 0)}]});return N(t,i),e.children.forEach(s=>{Q({domParent:i,parentNode:i,jsxNode:s})}),o&&o(n),i}if(j(e)){let n=e,r=[],o=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:null,onUnmount:r});N(t,o);let i=n.observe(s=>{if(s.type==="init"){let{items:l}=s;l.forEach(a=>{Q({domParent:o.domParent,parentNode:o,jsxNode:a})})}else if(s.type!=="sort"){if(s.type==="splice"){let{count:l,index:a,items:g}=s,u=g.map(()=>W({domParent:o.domParent,parentNode:o}));te(o,o.children[a],l,u),g.forEach((S,Z)=>{R({nodeToReplace:u[Z],jsxNode:S})})}}});return _(n),r.push(i),r.push(()=>{y(n)}),o}if(w(e)){let n=e,r=[],o=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:null,onUnmount:r});N(t,o);let i=W({parentNode:o,domParent:o.domParent});o.children.push(i);let s=G(I(()=>{let l=n();i=R({nodeToReplace:i,jsxNode:l})}),"view:calc:");return _(s),r.push(()=>y(s)),s(),o}if(Ee(e)){let n=[],r=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:null,onUnmount:n});N(t,r);let o=W({parentNode:r,domParent:r.domParent});r.children.push(o);let i=e.component,s=G(I(()=>{let l=[],a=[],g=i(Object.assign(Object.assign({},e.props||{}),{children:e.children}),{onUnmount:u=>{l.push(u)},onMount:u=>{a.push(u)},onEffect:u=>{let S=I(u);a.push(()=>{_(S),S()}),l.push(()=>{y(S)})}});o=R({nodeToReplace:o,jsxNode:g}),a.forEach(u=>u())}),`view:component:${e.component.name}:`);return _(s),n.push(()=>y(s)),s(),r}if(Array.isArray(e)){let n=e,r=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:null,onUnmount:[]});return N(t,r),n.forEach(o=>{Q({domParent:r.domParent,parentNode:r,jsxNode:o})}),r}if(typeof e=="function"){let n=b({parentNode:t.parentNode,domParent:t.domParent,jsxNode:e,domNode:null,onUnmount:[]});return N(t,n),he("Attempted to render JSX node that was a function, not rendering anything"),n}ge(e,"unexpected render type")}function we(t,e){let n=be({domNode:t});Q({domParent:n,parentNode:n,jsxNode:e})}var Pe=({children:t})=>t;var Ue=ve,$e="development",z=[],oe=new Map,B=new WeakMap;function h(t){var e,n,r;return j(t)?`coll:${(e=B.get(t))!==null&&e!==void 0?e:"?"}`:w(t)?`${fe(t)?"eff":"comp"}:${(n=B.get(t))!==null&&n!==void 0?n:"?"}`:`model:${(r=B.get(t.model))!==null&&r!==void 0?r:"?"}:${String(t.key)}`}var D=new V,f=new V;function Ie(){D=new V,z=[],oe=new Map,f=new V,B=new WeakMap}function G(t,e){return B.set(t,e),t}function De(t){if(typeof t!="object"||!t)throw new M("model must be provided an object");let e=new Map,n=new Proxy(t,{get(r,o){if(o===v)return"model";let i=e.get(o);return i||(i={model:n,key:o},e.set(o,i)),re(i),r[o]},set(r,o,i){let s=e.get(o);return s||(s={model:n,key:o},e.set(o,s)),L(s),r[o]=i,!0}});return n}function Se(t){if(!Array.isArray(t))throw new M("collection must be provided an array");let e=new Map,n=[];function r(d){n.forEach(c=>{c(d)})}function o(d,c,...p){if(c<1&&p.length===0)return[];let C=t.length,H=t.splice(d,c,...p),T=t.length;if(r({type:"splice",index:d,count:c,items:p}),C===T)for(let O=d;O<d+c;++O)L(A(O.toString()));else{for(let O=d;O<Math.max(T,C);++O)L(A(O.toString()));L(A("length"))}return H}function i(){return o(t.length-1,1)[0]}function s(){return o(0,1)[0]}function l(...d){return o(t.length,0,...d),t.length}function a(...d){return o(0,0,...d),t.length}function g(d){return t.sort(d),n.forEach(c=>{c({type:"sort"})}),F}function u(d){let c=Se(t.map(d));return F.observe(p=>{if(p.type!=="sort"&&p.type==="splice"){let{index:C,count:H,items:T}=p;c.splice(C,H,...T.map(d))}}),c}function S(d,c){o(d,1,c)}function Z(d){return n.push(d),d({type:"init",items:t}),()=>{n=n.filter(c=>c!==d)}}let J={splice:o,pop:i,shift:s,push:l,unshift:a,observe:Z,sort:g,mapView:u};function A(d){let c=e.get(d);return c||(c={model:F,key:d},e.set(d,c)),c}let F=new Proxy(t,{get(d,c){if(c in J)return J[c];if(c===v)return"collection";let p=A(c);return Fe(F,p),re(p),d[c]},set(d,c,p){if(c in J)return m("Overriding certain collection methods not supported",c),!1;let C=Number(c);if(!isNaN(C)&&C<=t.length)return S(C,p),!0;let H=A(c);return L(H),d[c]=p,!0},deleteProperty(d,c){if(c in J)return m("Deleting certain collection methods not supported",c),!1;let p=A(c);return L(p),delete d[c],!0}});return F}function Le(t){return Oe(t,!1)}function I(t){return Oe(t,!0)}function Oe(t,e){if(typeof t!="function")throw new M("calculation must be provided a function");let n,r=()=>{n=void 0},o=(e?ue:ae)(function(){if(e||re(o),n)return n.result;let s=f.getReverseDependencies(o).map(a=>[a,o]);if(f.removeEdges(s),z.push(o),n={result:t()},z.pop()!==o)throw new M("Active calculation stack inconsistency!");return n.result});return f.addNode(o),oe.set(o,r),o}function re(t){let e=z[z.length-1];e&&(f.addNode(t),f.hasNode(e)||f.addNode(e),f.addEdge(t,e)&&E("New global dependency",h(t),"->",h(e)))}function Fe(t,e){f.addNode(t),f.addNode(e),f.addEdge(t,e)&&E("New global collection dependency",h(t),"->",h(e))}function L(t){let e=n=>{D.addNode(n),f.getDependencies(n).forEach(o=>{D.hasNode(o)||e(o),D.addEdge(n,o)&&E("New local dependency",h(t),"->",h(o)),Y||(Y=!0,We())})};e(t)}var Y=!1,ie=new Set;function He(t){return ie.add(t),()=>ie.delete(t)}function We(){ie.forEach(t=>{try{t()}catch(e){X(e,"unhandled exception in subscriber")}})}function Ge(){if(!Y)return;Y=!1;let t=D;D=new V,t.visitTopological(e=>{if(w(e)){E("flushing calculation",h(e));let n=oe.get(e);n&&n(),e()}else E("flushing model",h(e))}),f.garbageCollect().forEach(e=>{w(e)?E("GC calculation",h(e)):E("GC model",h(e))})}function _(t){E("retain",h(t)),f.hasNode(t)||f.addNode(t),f.retain(t)}function y(t){E("release",h(t)),f.release(t)}function ze(){return f.graphviz((t,e)=>`${t}
${h(e)}`)}return Be;})();
//# sourceMappingURL=index.min.js.map
